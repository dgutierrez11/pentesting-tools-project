FROM yotis/ubuntu1604-pfne
# #FROM ubuntu:20.04

RUN apt-get update -y \
  && apt-get install -y python3-pip python3-dev \
  && cd /usr/local/bin \
  && ln -s /usr/bin/python3 python \
  && pip3 --no-cache-dir install --upgrade pip \
  && rm -rf /var/lib/apt/lists/*  \
  && apt-get install build-essential

# This is in accordance to : https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-get-on-ubuntu-16-04
RUN apt-get update && \
	apt-get install -y openjdk-8-jdk && \
	apt-get install -y ant && \
	apt-get clean && \
	rm -rf /var/lib/apt/lists/* && \
	rm -rf /var/cache/oracle-jdk8-installer;
	
# Fix certificate issues, found as of 
# https://bugs.launchpad.net/ubuntu/+source/ca-certificates-java/+bug/983302
#RUN apt-get update && \
#	apt-get install -y ca-certificates-java && \
#	apt-get clean && \
#	update-ca-certificates -f && \
#	rm -rf /var/lib/apt/lists/* && \
#	rm -rf /var/cache/oracle-jdk8-installer;

# Setup JAVA_HOME, this is useful for docker commandline
ENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64/
RUN export JAVA_HOME

WORKDIR /app

ADD . /app

RUN ls -lha /app

## #RUN sources venv/bin/activate
RUN chmod +x /app/venv/bin/activate

RUN apt-get update \ 
  && apt-get install -y libpq-dev python3-dev

RUN python3 setup.py install

# Se instala ZAP 
RUN tar xzvf /app/Apps/ZAP_2.10.0_Linux.tar.gz -C /app/Apps
RUN chmod +x /app/Apps/ZAP_2.10.0/zap.sh
# #RUN /app/Apps/ZAP_2.10.0/zap.sh -daemon -config api.disablekey=true > /dev/null 2>&1 &

# # CMD ['/bin/sh', 'ZAP_2_10_0_unix.sh']
# CMD . /app/venv/bin/activate && exec-pentesting-tools

CMD exec-pentesting-tools
