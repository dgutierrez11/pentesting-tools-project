import time
import os
import subprocess
from datetime import datetime
from pprint import pprint
from zapv2 import ZAPv2
from persistence.postgres_bd import ConnectionPostgres

from cwe import Database

db = Database()
#weakness = db.get(308)
weakness = db.get(79)
#print(type(db))
#print(type(weakness))
print("Prueba: " + weakness.observed_examples)

#cp = ConnectionPostgres()
print('Starting Zap ...')
#print(iter(db.get_top_25().keys()))
list_records = []
index = 1
for k, v in db.get_top_25().items():
    if k != '79':
        #print(type(v))
        #print(v)
        record = (index, v.get('Name'), 'alert', 'High',
                  v.get('Description'), v.get('CWE-ID'), datetime.now())
        list_records.append(record)
        index = index + 1
        print(record)
#print(db.get_top_25())

# Se imprime todos los registros
#print(list_records)

# prueba = ConnectionPostgres()
# prueba.execute_query("SELECT * FROM alert")
# params = ("alert5", "Information Error", "", "Error", "The response is incorrect", 201, datetime.now())
# prueba.add_record(params)

# print('Starting Zap ...')

#p = subprocess.Popen(['/usr/local/bin/zap.sh', '-daemon'], stdout=open(os.devnull, 'w'),
 #                  stderr=subprocess.PIPE, universal_newlines=True)#
#print('Waiting for ZAP to load ...'
#time.sleep(120)
#print('Finish...')


#To close ZAP:
#zap.core.shutdown()
